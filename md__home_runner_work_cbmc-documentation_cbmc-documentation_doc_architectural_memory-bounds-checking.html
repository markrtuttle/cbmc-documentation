<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CBMC: memory-bounds-checking</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CBMC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__home_runner_work_cbmc-documentation_cbmc-documentation_doc_architectural_memory-bounds-checking.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">memory-bounds-checking </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>module_hidden memory-bounds-checking Memory Bounds Checking</p>
<p>cbmc provides means to verify that pointers are within the bounds of (statically or dynamically) allocated memory blocks. When the option <code>--pointer-check</code> is used, cbmc checks the safety of each pointer dereference in the program. Similarly, the primitive <code>__CPROVER_r_ok(pointer, size)</code> returns true when it is safe to read from the memory segment starting at <code>pointer</code> and extending for <code>size</code> bytes. <code>__CPROVER_w_ok(pointer, size)</code> indicates if writing to the given segment is safe. At present, both primitives behave the same.</p>
<p>Each memory segment is referred to internally in cbmc via an object id. Pointers are represented as bitvectors (typically of length 32 or 64). The topmost <code>n</code> bits encode the id of the memory segment the pointer is pointing to, and the remaining bits encode the offset within the segment. The number of bits used to represent the object id can be specified via <code>--object-bits n</code>. Object offsets are signed. This allows to distinguish the case of when a pointer has been incremented too much from the case of when a pointer has been decremented too much. In the latter case, a negative value would be visible for the offset portion of a pointer in an error trace.</p>
<p>In the following, we describe how the memory bounds checks are implemented in cbmc for dynamically allocated memory. Dynamic memory is allocated in C via the <code>malloc()</code> library function. Its model in cbmc looks as follows (see <code>src/ansi-c/library/stdlib.c</code>, details not related to memory bounds checking are left off):</p>
<div class="fragment"><div class="line">inline void *malloc(__CPROVER_size_t malloc_size)</div>
<div class="line">{</div>
<div class="line">  void *malloc_res;</div>
<div class="line">  malloc_res = __CPROVER_allocate(malloc_size, 0);</div>
<div class="line">  return malloc_res;</div>
<div class="line">}</div>
</div><!-- fragment --><p>When the option <code>--pointer-check</code> is used, cbmc generates the following verification condition for each pointer dereference expression (e.g., <code>*pointer</code>):</p>
<div class="fragment"><div class="line">__CPROVER_POINTER_OFFSET(pointer) &gt;= 0 &amp;&amp;</div>
<div class="line">__CPROVER_POINTER_OFFSET(pointer) &lt; __CPROVER_OBJECT_SIZE(pointer)</div>
</div><!-- fragment --><p>The primitives <code><a class="el" href="cprover__builtin__headers_8h.html#af66015ac3e467377c4ad94c0fcc4cb97">__CPROVER_POINTER_OFFSET()</a></code> and <code><a class="el" href="cprover__builtin__headers_8h.html#a38adef7c2c9358562c98c9f2b54115fd">__CPROVER_OBJECT_SIZE()</a></code> extract the pointer offset and size of the object pointed to, respectively. Similar conditions are generated for <code>assert(__CPROVER_r_ok(pointer, size))</code> and <code>assert(__CPROVER_w_ok(pointer, size))</code>.</p>
<p>To illustrate how the bounds checking works, consider the following example program which is unsafe:</p>
<div class="fragment"><div class="line">int main()</div>
<div class="line">{</div>
<div class="line">  char *p1 = malloc(1);</div>
<div class="line">  p1++;</div>
<div class="line">  char *p2 = malloc(2);</div>
<div class="line"> </div>
<div class="line">  *p1 = 1;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Here the verification condition generated for the pointer dereference should fail: for <code>p1</code> in <code>*p1</code>, <code>__CPROVER_POINTER_OFFSET</code> will evaluate to 1 (owing to the increment <code>p1++</code>, and <code>__CPROVER_OBJECT_SIZE</code> will also evaluate to 1. Consequently, the less-than comparison in the verification condition evaluates to false.</p>
<p>Last modified: 2022-09-21 18:26:09 -0400 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
