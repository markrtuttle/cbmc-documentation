<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CProver manual: jbmc-user-manual</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CProver manual
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">jbmc-user-manual </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>CPROVER Manual TOC</p>
<h1><a class="anchor" id="autotoc_md132"></a>
Verifying Java with JBMC</h1>
<h2><a class="anchor" id="autotoc_md133"></a>
Introduction</h2>
<p>JBMC is a bounded model checking tool for the Java language. It follows the same principles as CBMC, thus the existing <a href="../cbmc/tutorial/">documentation for CBMC</a> largely applies to JBMC.</p>
<p>In brief, JBMC creates a model from Java Bytecode (given as input as a <code>.class</code> file or a <code>.jar</code>) and performs static analysis and symbolic execution which allow us to prove or refute properties. These properties are either automatically generated (runtime errors), or provided by the user in the form of assertions.</p>
<p>Using examples, the following section will guide you through the basic features of JBMC.</p>
<h2><a class="anchor" id="autotoc_md134"></a>
JBMC tutorial</h2>
<h3><a class="anchor" id="autotoc_md135"></a>
Automatic assertions</h3>
<p>Consider the following simplistic <code>ExampleArray.java</code> file which we have compiled into <code>tutorial/ExampleArray.class</code> and which queries the array of input arguments at index 3: </p><div class="fragment"><div class="line"> 1| package tutorial;</div>
<div class="line"> 2|</div>
<div class="line"> 3| public class ExampleArray {</div>
<div class="line"> 4|</div>
<div class="line"> 5|     public static void main(String[] args) {</div>
<div class="line"> 6|         final int index = 3;</div>
<div class="line"> 7|         String arg3 = args[index];</div>
<div class="line"> 8|     }</div>
<div class="line"> 9|</div>
<div class="line">10| }</div>
</div><!-- fragment --><p>Now let's run the following command to let JBMC tell us about potential errors in our program. </p><div class="fragment"><div class="line">$ jbmc tutorial.ExampleArray</div>
</div><!-- fragment --><p>The output contains the following: </p><div class="fragment"><div class="line">[java::tutorial.ExampleArray.main:([Ljava/lang/String;)V.null-pointer-exception.1] line 7 Null pointer check: SUCCESS</div>
<div class="line">[java::tutorial.ExampleArray.main:([Ljava/lang/String;)V.array-index-out-of-bounds-low.1] line 7 Array index should be &gt;= 0: SUCCESS</div>
<div class="line">[java::tutorial.ExampleArray.main:([Ljava/lang/String;)V.array-index-out-of-bounds-high.1] line 7 Array index should be &lt; length: FAILURE</div>
<div class="line">[java::tutorial.ExampleArray.main:([Ljava/lang/String;)V.1] line 7 no uncaught exception: SUCCESS</div>
<div class="line"> </div>
<div class="line">** 1 of 13 failed (2 iterations)</div>
<div class="line">VERIFICATION FAILED</div>
</div><!-- fragment --><p>We have a reported failure: JBMC found that the array access could potentially be out of bounds, if the size of the argument array is too small.</p>
<p>If we make our code more robust by adding guards to make the array access safe as follows: </p><div class="fragment"><div class="line"> 1| package tutorial;</div>
<div class="line"> 2|</div>
<div class="line"> 3| public class ExampleArraySafe {</div>
<div class="line"> 4|</div>
<div class="line"> 5|     public static void main(String[] args) {</div>
<div class="line"> 6|         final int index = 3;</div>
<div class="line"> 7|         String arg3 = &quot;none&quot;;</div>
<div class="line"> 8|         if (index &lt; args.length) {</div>
<div class="line"> 9|             arg3 = args[index];</div>
<div class="line">10|         }</div>
<div class="line">11|     }</div>
<div class="line">12|</div>
<div class="line">13| }</div>
</div><!-- fragment --><p>then when running JBMC on that corrected version: </p><div class="fragment"><div class="line">$ jbmc tutorial.ExampleArraySafe</div>
</div><!-- fragment --><p>all the automatic assertions become valid, meaning that there is no possible inputs (argument values) for which they can be violated: </p><div class="fragment"><div class="line">[java::tutorial.ExampleArraySafe.main:([Ljava/lang/String;)V.1] line 7 no uncaught exception: SUCCESS</div>
<div class="line">[java::tutorial.ExampleArraySafe.main:([Ljava/lang/String;)V.null-pointer-exception.1] line 8 Null pointer check: SUCCESS</div>
<div class="line">[java::tutorial.ExampleArraySafe.main:([Ljava/lang/String;)V.null-pointer-exception.2] line 9 Null pointer check: SUCCESS</div>
<div class="line">[java::tutorial.ExampleArraySafe.main:([Ljava/lang/String;)V.array-index-out-of-bounds-low.1] line 9 Array index should be &gt;= 0: SUCCESS</div>
<div class="line">[java::tutorial.ExampleArraySafe.main:([Ljava/lang/String;)V.array-index-out-of-bounds-high.1] line 9 Array index should be &lt; length: SUCCESS</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md136"></a>
Loop unwinding</h2>
<p>As CBMC, JBMC needs to unwind loops up to a given value. Consider the <code>isPrime</code> method in the code below. Without specifying an unwind limit, JBMC will not terminate when analyzing the following function whose state representation is theoretically unbounded (because of the for-loop whose number of iterations depends on an input): </p><div class="fragment"><div class="line"> 1| package tutorial;</div>
<div class="line"> 2|</div>
<div class="line"> 3| public class ExampleUnwind {</div>
<div class="line"> 4|</div>
<div class="line"> 5|     public static void doSomething(int inputVal) {</div>
<div class="line"> 6|         if (inputVal &gt; 1 &amp;&amp; inputVal % 2 == 1) {</div>
<div class="line"> 7|             assert isPrime(inputVal);</div>
<div class="line"> 8|             // do something</div>
<div class="line"> 9|         }</div>
<div class="line">10|     }</div>
<div class="line">11|</div>
<div class="line">12|     public static boolean isPrime(int candidate) {</div>
<div class="line">13|         for (int div = 2; div * div &lt;= candidate; div++) {</div>
<div class="line">14|             if (candidate % div == 0) {</div>
<div class="line">15|                 return false;</div>
<div class="line">16|             }</div>
<div class="line">17|         }</div>
<div class="line">18|         return candidate &gt; 1;</div>
<div class="line">19|     }</div>
<div class="line">20|</div>
<div class="line">21| }</div>
</div><!-- fragment --><p>To limit the number of times the for-loop is unwound, we use the <code>--unwind N</code> options, in which case the following call to JBMC: </p><div class="fragment"><div class="line">$ jbmc tutorial.ExampleUnwind.isPrime --unwind 10</div>
</div><!-- fragment --><p>will terminate correctly. In this case, we will see <code>VERIFICATION SUCCESSFUL</code>, as no automatic assertions are violated.</p>
<p>Note that in that example, there are is no main function, so we give specify the desired entry point via the <code>--function</code> option.</p>
<h2><a class="anchor" id="autotoc_md137"></a>
User assertions</h2>
<p>Elaborating on the example above, users may provide their own assertions, that JBMC will try to refute. On line 7, we check the assertion that all odd numbers greater than 1 are prime. To be sure that this always holds, we run JBMC on the example, with a reasonable <code>unwind</code> value: </p><div class="fragment"><div class="line">$ jbmc tutorial.ExampleUnwind.doSomething --unwind 10</div>
</div><!-- fragment --><p>Unsurprisingly JBMC doesn't agree, and prints an assertion failure (truncated here for readability): </p><div class="fragment"><div class="line">[...doSomething:(I)V.assertion.1] line 7 assertion at file tutorial/ExampleUnwind.java: FAILURE</div>
</div><!-- fragment --><p>Rerunning the analysis with the <code>--trace</code> option, the following line appears somewhere in the trace output and tells us which input value JBMC found to trigger the violation (note that to see the original parameter names in the trace output, the Java source must be compiled in debug mode: <code>javac -g</code>): </p><div class="fragment"><div class="line">INPUT inputVal: 15</div>
</div><!-- fragment --><p>The value chosen by JBMC is arbitrary, and could as well be 9 or 2084569161.</p>
<h2><a class="anchor" id="autotoc_md138"></a>
Java Library support</h2>
<p>The examples above only involve primitive types. In order to analyse code involving Java Library classes, the core models (located in the same repository) need to be added to the classpath: </p><div class="fragment"><div class="line">--cp &lt;path_to_cbmc&gt;/jbmc/src/java_bytecode/library/core-models.jar</div>
</div><!-- fragment --><p>The core models library simulate the behavior of the Java Library and contains some commonly used classes, such as Object, Class, String, Enum. Some JBMC-specific utilities reside in the <code>org.cprover</code> package.</p>
<p>Using the models, JBMC can reason with a variety of String operations from <code>java.lang.String</code>, e.g. </p><div class="fragment"><div class="line"> 1| package tutorial;</div>
<div class="line"> 2|</div>
<div class="line"> 3| public class ExampleModels {</div>
<div class="line"> 4|</div>
<div class="line"> 5|     public static void main(String[] args) {</div>
<div class="line"> 6|         StringBuilder sb = new StringBuilder(&quot;abcd&quot;);</div>
<div class="line"> 7|         StringBuilder sb2 = sb.insert(2, &quot;$&quot;);</div>
<div class="line"> 8|         assert sb2.toString().startsWith(&quot;abc&quot;);</div>
<div class="line"> 9|     }</div>
<div class="line">10|</div>
<div class="line">11| }</div>
</div><!-- fragment --><p>The following command line (note that the current directory is also added to the classpath): </p><div class="fragment"><div class="line">$ jbmc tutorial.ExampleModels --cp &lt;path_to_cbmc&gt;/jbmc/src/java_bytecode/library/core-models.jar:.</div>
</div><!-- fragment --><p>will flag this violation (truncated): </p><div class="fragment"><div class="line">[java::tutorial.ExampleModels.stringOp:()V.assertion.1] line 8 assertion: FAILURE</div>
</div><!-- fragment --><p>Again, the trace (when re-running with <code>--trace</code>) shows the string violating the condition in the assertion: </p><div class="fragment"><div class="line">dynamic_object2={ &#39;a&#39;, &#39;b&#39;, &#39;$&#39;, &#39;c&#39;, &#39;d&#39; }</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md139"></a>
Exceptions</h2>
<p>In its analysis, JBMC can take into account exceptions thrown by user code or library classes, as well as runtime exceptions such as NullPointerException. To have JBMC reliably notify about all uncaught exceptions, the <code>--throw-runtime-exceptions</code> can be used.</p>
<p>Consider the following code: </p><div class="fragment"><div class="line">1| package tutorial;</div>
<div class="line">2|</div>
<div class="line">3| public class ExampleExceptions {</div>
<div class="line">4|</div>
<div class="line">5|     public static int strLength(String str) {</div>
<div class="line">6|         return str.length();</div>
<div class="line">7|     }</div>
<div class="line">8|</div>
<div class="line">9| }</div>
</div><!-- fragment --><p>When given the <code>--throw-runtime-exceptions</code> options: </p><div class="fragment"><div class="line">$ jbmc tutorial.ExampleExceptions.strLength --throw-runtime-exceptions</div>
</div><!-- fragment --><p>JBMC will signal that the <code>str.length()</code> call may throw a runtime exception and that this exception is not caught. </p><div class="fragment"><div class="line">[java::tutorial.ExampleExceptions.strLength:(Ljava/lang/String;)I.1] line 6 no uncaught exception: FAILURE</div>
</div><!-- fragment --><p>This could be fixed by adding a try-catch statement, or else checking that <code>str</code> is non-null before accessing it.</p>
<p>To silence errors about uncaught exceptions while keeping JBMC's ability to throw runtime exceptions (for example when analyzing code that has try-catch blocks), the <code>--disable-uncaught-exception-check</code> option can be added. In our example, the assertion check will disappear completely from the output: </p><div class="fragment"><div class="line">Generated 2 VCC(s), 0 remaining after simplification</div>
<div class="line">VERIFICATION SUCCESSFUL</div>
</div><!-- fragment --><p>When analyzing this function without runtime exception support: </p><div class="fragment"><div class="line">$ jbmc tutorial.ExampleExceptions</div>
</div><!-- fragment --><p>JBMC only reports the error as a null pointer check failure: </p><div class="fragment"><div class="line">[...null-pointer-exception.1] line 6 Null pointer check: FAILURE</div>
<div class="line">[...strLength:(Ljava/lang/String;)I.1] line 6 no uncaught exception: SUCCESS</div>
</div><!-- fragment --><p>It is worth noting that in the JVM, <code>assert</code> actually throws an AssertionError on violation. This behavior can be replicated in JBMC by using the <code>--throw-assertion-error</code>. Violations of user assertions (if uncaught) would then be reported like any other uncaught exception.</p>
<h2><a class="anchor" id="autotoc_md140"></a>
Further documentation</h2>
<p>JBMC has a wealth of other options that can either constrain the model (to cope with complexity issues), or output more relevant information. The list of all available options is printed by running: </p><div class="fragment"><div class="line">$ jbmc --help</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
