<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CProver manual: contracts-requires-and-ensures</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CProver manual
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">contracts-requires-and-ensures </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href=".">CPROVER Manual TOC</a></p>
<h1><a class="anchor" id="autotoc_md94"></a>
Requires \&amp; Ensures Clauses</h1>
<h3><a class="anchor" id="autotoc_md95"></a>
Syntax</h3>
<p><code>c __CPROVER_requires(bool cond)</code></p>
<p>A <em>requires</em> clause specifies a precondition for a function, i.e., a property that must hold to properly execute the operation. Developers may see the <em>requires</em> clauses of a function as obligations on the caller when invoking the function. The precondition of a function is the conjunction of the <em>requires</em> clauses, or <code>true</code> if none are specified.</p>
<p><code>c __CPROVER_ensures(bool cond)</code></p>
<p>An <em>ensures</em> clause specifies a postcondition for a function, i.e., a property over arguments or global variables that the function guarantees at the end of the operation. Developers may see the <em>ensures</em> clauses of a function as the obligations of that function to the caller. The postcondition of a function is the conjunction of the <em>ensures</em> clauses, or <code>true</code> if none are specified.</p>
<h3><a class="anchor" id="autotoc_md96"></a>
Parameters</h3>
<p>A <em>requires</em> clause takes a Boolean expression over the arguments of a function and/or global variables, including CBMC primitive functions (e.g., <a class="el" href="md_contracts-memory-predicates.html">Memory Predicates</a>). Similarly, <em>ensures</em> clauses also accept Boolean expressions and CBMC primitives, but also <a class="el" href="md_contracts-history-variables.html">History Variables</a> and <code>__CPROVER_return_value</code>.</p>
<p><b>Important.</b> Developers may call functions inside <em>requires</em> and <em>ensures</em> clauses to better write larger specifications (e.g., predicates). However, at this point CBMC does not enforce such functions to be without side effects (i.e., do not modify any global state). This will be checked in future versions.</p>
<h3><a class="anchor" id="autotoc_md97"></a>
Semantics</h3>
<p>The semantics of <em>ensures</em> and <em>requires</em> clauses can be understood in two contexts: enforcement and replacement. To illustrate these two perspectives, consider the following implementation of the <code>sum</code> function.</p>
<p><code>c int sum(const uint32_t a, const uint32_t b, uint32_t* out) /* Precondition */ __CPROVER_requires(__CPROVER_is_fresh(out, sizeof(*out))) /* Postconditions */ __CPROVER_ensures(__CPROVER_return_value == SUCCESS || __CPROVER_return_value == FAILURE) __CPROVER_ensures((__CPROVER_return_value == SUCCESS) ==&gt; (*out == (a + b))) { const uint64_t result = ((uint64_t) a) + ((uint64_t) b); if (result &gt; UINT32_MAX) return FAILURE; *out = (uint32_t) result; return SUCCESS; }</code></p>
<h4><a class="anchor" id="autotoc_md98"></a>
Enforcement</h4>
<p>In order to determine whether <em>requires</em> and <em>ensures</em> clauses are a sound abstraction of the behavior of a function <em>f</em>, CBMC will try to check them as follows:</p>
<ol type="1">
<li>Considers all arguments and global variables as non-deterministic values;</li>
<li>Assumes all preconditions specified in the <code>__CPROVER_requires</code> clauses;</li>
<li>Calls the implementation of function <em>f</em>;</li>
<li>Asserts all postconditions described in the <code>__CPROVER_ensures</code> clauses.</li>
</ol>
<p>In our example, the <code>sum</code> function will be instrumented as follows:</p>
<p>```c /* Function Contract Enforcement */ int sum(uint32_t a, uint32_t b, uint32_t* out) { __CPROVER_assume(__CPROVER_is_fresh(out, sizeof(*out)));</p>
<p>int return_value_sum = __CPROVER_contracts_original_sum(a, b, out);</p>
<p>__CPROVER_assert(return_value_sum == SUCCESS \|\| return_value_sum == FAILURE, "Check ensures clause"); __CPROVER_assert((return_value_sum == SUCCESS) ==&gt; (*out == (a + b)), "Check ensures clause");</p>
<p>return return_value_sum; } ```</p>
<h4><a class="anchor" id="autotoc_md99"></a>
Replacement</h4>
<p>Assuming <em>requires</em> and <em>ensures</em> clauses are a sound abstraction of the behavior of the function <em>f</em>, CBMC will use the function contract in place of the function implementation as follows:</p>
<ol type="1">
<li>Adds assertions for all preconditions specified in the <code>__CPROVER_requires</code> clauses;</li>
<li>Adds non-deterministic assignments for each symbol listed in the <code>__CPROVER_assigns</code> clause (see <a class="el" href="md_contracts-assigns.html">Assigns Clause</a> for details);</li>
<li>Assumes all postconditions described in the <code>__CPROVER_ensures</code> clauses;</li>
</ol>
<p>In our example, consider that a function <code>foo</code> may call <code>sum</code>.</p>
<p><code>c int foo() { uint32_t a; uint32_t b; uint32_t out; int rval = sum(a, b, &amp;out); if (rval == SUCCESS) return out; return rval; }</code></p>
<p>CBMC will use the function contract in place of the function implementation wherever the function is called.</p>
<p>```c int foo() { uint32_t a; uint32_t b; uint32_t out;</p>
<p>/* Function Contract Replacement */ /* Precondition */ __CPROVER_assert(__CPROVER_is_fresh(out, sizeof(*out)), "Check requires clause");</p>
<p>/* Postconditions */ int return_value_sum = nondet_int(); __CPROVER_assume(return_value_sum == SUCCESS \|\| return_value_sum == FAILURE); __CPROVER_assume((return_value_sum == SUCCESS) ==&gt; (*out == (*a + *b)));</p>
<p>int rval = return_value_sum; if (rval == SUCCESS) return out; return rval; } ```</p>
<p>Last modified: 2022-09-21 19:02:04 -0400 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
